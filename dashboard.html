<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Dashboard | Beyond Academics</title>
    <style>
        :root { --bg-color: #0f172a; --card-bg: rgba(30, 41, 59, 0.7); --text-primary: #f8fafc; --accent: #6366f1; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-color); color: var(--text-primary); margin: 0; padding: 0; overflow-x: hidden; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 20px 40px; background: rgba(0,0,0,0.3); border-bottom: 1px solid #333; }
        .logo { font-weight: 800; font-size: 1.2rem; color: #fff; }
        .logout-btn { background: transparent; border: 1px solid #ef4444; color: #ef4444; padding: 8px 16px; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .logout-btn:hover { background: #ef4444; color: white; }
        .container { max-width: 1000px; margin: 40px auto; padding: 20px; }
        .welcome-banner { background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); padding: 40px; border-radius: 16px; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: var(--card-bg); padding: 25px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .tag { background: #22c55e; color: black; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .action-btn { background: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; color: #0f172a; width: 100%; margin-top: 10px; }
    </style>
</head>
<body>
    <nav class="navbar"><div class="logo">üöÄ Beyond Academics</div><button id="logout-btn" class="logout-btn">Log Out</button></nav>
    <div class="container">
        <div class="welcome-banner"><h1>Welcome back, <span id="user-name">Member</span>!</h1><p>Ready for this week's logic jam?</p></div>
        <div class="grid">
            <div class="card">
                <h2 id="challenge-header">Loading... <span class="tag" id="challenge-status">...</span></h2>
                <p style="color: #cbd5e1; margin-top: 10px;" id="challenge-details">Connecting to HQ...</p>
                <hr style="border-color: rgba(255,255,255,0.1); margin: 20px 0;">
                
                <div id="challenge-description" style="color: #cbd5e1; white-space: pre-line; margin-bottom: 25px; line-height: 1.6;">
                    Loading details...
                </div>
                <button id="challenge-btn" class="action-btn">View Problem Statement ‚ûî</button>
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.2);">
                    <p style="font-size: 0.85rem; color: #94a3b8; margin-bottom: 8px;">‚úÖ Done? Paste your GitHub Gist / LeetCode link:</p>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="submission-link" placeholder="https://..." style="width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #475569; background: #0f172a; color: white;">
                        <button id="submit-btn" style="background: #22c55e; color: black; border: none; padding: 0 20px; border-radius: 6px; font-weight: bold; cursor: pointer;">Submit</button>
                    </div>
                    <p id="submit-msg" style="font-size: 0.8rem; margin-top: 5px; min-height: 20px;"></p>
                </div>
            </div>
            <div class="card">
                <h3>üìö Resource Drop</h3><p style="font-size: 0.9rem; color: #aaa;">Curated by Tech Lead</p>
                <div id="resource-box" style="margin-top: 15px;"><p style="color:#64748b">Loading resources...</p></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyAIN0wAqPcPTqgZ6PrejDHcPnWcLOoyWOY", authDomain: "beyond-academics-web.firebaseapp.com", projectId: "beyond-academics-web", storageBucket: "beyond-academics-web.firebasestorage.app", messagingSenderId: "629372056950", appId: "1:629372056950:web:a98541b13caad1391cb657" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app);
        let currentUser = null;

        onAuthStateChanged(auth, (user) => {
            if (user) { currentUser = user; document.getElementById("user-name").innerText = user.displayName.split(" ")[0]; getChallengeData(); } 
            else { window.location.href = "index.html"; }
        });

        document.getElementById("logout-btn").addEventListener("click", () => { signOut(auth).then(() => { window.location.href = "index.html"; }); });

        async function getChallengeData() {
            try {
                const headerEl = document.getElementById("challenge-header");
                const detailsEl = document.getElementById("challenge-details");
                const descEl = document.getElementById("challenge-description"); // NEW
                const btnEl = document.getElementById("challenge-btn");
                const resourceBox = document.getElementById("resource-box");

                if (!headerEl || !detailsEl || !btnEl) return;

                const docRef = doc(db, "app_data", "week_1");
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    headerEl.innerHTML = `Week 1 Challenge <span class="tag" id="challenge-status">${data.status}</span>`;
                    detailsEl.innerHTML = `<strong>Topic:</strong> ${data.topic}<br><strong>Problem:</strong> "${data.title}"`;
                    
                    // NEW: Display the Description
                    descEl.innerText = data.description || "No specific details for this challenge.";

                    const newBtn = btnEl.cloneNode(true);
                    btnEl.parentNode.replaceChild(newBtn, btnEl);
                    newBtn.innerText = "Solve on LeetCode ‚ûî";
                    newBtn.addEventListener("click", () => {
                        let safeLink = data.link || "";
                        if (safeLink && !safeLink.startsWith("http")) safeLink = "https://" + safeLink;
                        if (safeLink) window.open(safeLink, '_blank');
                    });

                    if(data.resourceTitle && data.resourceLink && resourceBox) {
                        let resSafeLink = data.resourceLink;
                        if (!resSafeLink.startsWith("http")) resSafeLink = "https://" + resSafeLink;
                        resourceBox.innerHTML = `<a href="${resSafeLink}" target="_blank" style="color: #6366f1; text-decoration: none; display: block; margin-bottom: 10px;">‚ñ∂ ${data.resourceTitle}</a>`;
                    }
                }
            } catch (error) { console.error("Error:", error); }
        }

        const submitBtn = document.getElementById("submit-btn");
        if(submitBtn) {
            submitBtn.addEventListener("click", async () => {
                const inputEl = document.getElementById("submission-link");
                const msgEl = document.getElementById("submit-msg");
                const link = inputEl.value;
                if(!link.includes("http")) { msgEl.style.color = "#ef4444"; msgEl.innerText = "‚ö†Ô∏è Invalid link."; return; }
                submitBtn.innerText = "Sending...";
                try {
                    await addDoc(collection(db, "submissions"), { userName: currentUser.displayName, userEmail: currentUser.email, link: link, challengeId: "week_1", timestamp: serverTimestamp() });
                    msgEl.style.color = "#4ade80"; msgEl.innerText = "‚úÖ Submitted!"; inputEl.value = ""; submitBtn.innerText = "Submit";
                } catch (error) { console.error(error); msgEl.style.color = "#ef4444"; msgEl.innerText = "‚ùå Error."; submitBtn.innerText = "Submit"; }
            });
        }
    </script>
</body>
</html>
